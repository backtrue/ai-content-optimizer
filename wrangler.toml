name = "ai-content-optimizer-worker"
main = "functions/api/[[path]].js"
compatibility_date = "2024-10-28"

# KV Namespace for storing analysis results
[[kv_namespaces]]
binding = "ANALYSIS_RESULTS"
id = "26377e2774624d0781a19b026e018b5f"
preview_id = "26377e2774624d0781a19b026e018b5f"

# Durable Object for async analysis queue (replaces Queues for free plan)
[[durable_objects.bindings]]
name = "ANALYSIS_QUEUE"
class_name = "AnalysisQueue"
script_name = "ai-content-optimizer-worker"

# Durable Object migrations (use SQLite for free plan)
[[migrations]]
tag = "v1"
new_sqlite_classes = ["AnalysisQueue"]

[env.production]
name = "ai-content-optimizer-worker-prod"
routes = [
  { pattern = "ragseo.thinkwithblack.com/api/analyze-worker", zone_name = "thinkwithblack.com" }
]

[[env.production.kv_namespaces]]
binding = "ANALYSIS_RESULTS"
id = "analysis_results_prod"

[[env.production.durable_objects.bindings]]
name = "ANALYSIS_QUEUE"
class_name = "AnalysisQueue"
script_name = "ai-content-optimizer-worker-prod"

[[env.production.migrations]]
tag = "v1"
new_sqlite_classes = ["AnalysisQueue"]
