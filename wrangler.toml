name = "ai-content-optimizer-worker"
main = "functions/api/[[path]].js"
compatibility_date = "2024-10-28"

# KV Namespace for storing analysis results
[[kv_namespaces]]
binding = "ANALYSIS_RESULTS"
id = "analysis_results_kv"
preview_id = "analysis_results_preview"

# Queue for async analysis tasks
[[queues.consumers]]
queue = "analysis-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "analysis-queue-dlq"

[env.production]
name = "ai-content-optimizer-worker-prod"
routes = [
  { pattern = "ragseo.thinkwithblack.com/api/analyze-worker", zone_name = "thinkwithblack.com" }
]

[[env.production.kv_namespaces]]
binding = "ANALYSIS_RESULTS"
id = "analysis_results_prod"

[[env.production.queues.consumers]]
queue = "analysis-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "analysis-queue-dlq"
