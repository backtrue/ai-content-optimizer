# ç³»çµ±è©•åˆ†è‡ªå‹•å„ªåŒ–æµç¨‹

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æª”è©³ç´°èªªæ˜ç³»çµ±å¦‚ä½•è‡ªå‹•æ”¶é›†ç”¨æˆ¶åˆ†æçš„é—œéµå­—ã€SERP æ’åæ•¸æ“šï¼Œä¸¦æŒçºŒå„ªåŒ–è©•åˆ†æ¨¡å‹çš„å®Œæ•´æµç¨‹ã€‚

---

## ğŸ”„ å®Œæ•´æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ¶åˆ†ææµç¨‹ï¼ˆå‰ç«¯ï¼‰                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. ç”¨æˆ¶è¼¸å…¥å…§å®¹ + ç›®æ¨™é—œéµå­—                                                â”‚
â”‚     â†“                                                                        â”‚
â”‚  2. å‰ç«¯èª¿ç”¨ /api/analyze æˆ– /api/analyze-worker                            â”‚
â”‚     â†“                                                                        â”‚
â”‚  3. ç³»çµ±è¿”å›è©•åˆ†çµæœ (SEO/AEO æŒ‡æ¨™)                                         â”‚
â”‚     â†“                                                                        â”‚
â”‚  4. é—œéµå­— + è©•åˆ†æ•¸æ“šè‡ªå‹•è¨˜éŒ„åˆ° KEYWORD_ANALYTICS KV                       â”‚
â”‚     â†“                                                                        â”‚
â”‚  5. æ•¸æ“šåŒæ­¥åˆ° Google Sheet (training_data)                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è‡ªå‹•åŒ– Pipeline æµç¨‹ï¼ˆæ¯é€±åŸ·è¡Œï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€ é€±ä¸€ 02:00 UTC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ éšæ®µ 1ï¼šé—œéµå­—åŒ¯å‡º                                                    â”‚  â”‚
â”‚  â”‚  - å¾ KEYWORD_ANALYTICS KV è®€å–ç”¨æˆ¶åˆ†æçš„é—œéµå­—                    â”‚  â”‚
â”‚  â”‚  - åŒ¯å‡ºç‚º JSON æ ¼å¼                                                 â”‚  â”‚
â”‚  â”‚  - ä¸Šå‚³è‡³ R2 bucket (keyword-exports)                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â†“                                       â”‚
â”‚  â”Œâ”€ é€±ä¸€ 02:30 UTC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ éšæ®µ 2ï¼šSERP è’é›†                                                    â”‚  â”‚
â”‚  â”‚  - è®€å– R2 ä¸­çš„é—œéµå­—åˆ—è¡¨                                           â”‚  â”‚
â”‚  â”‚  - èª¿ç”¨ SerpAPI/ValueSERP/ZenSERP ç²å–æ’åæ•¸æ“š                     â”‚  â”‚
â”‚  â”‚  - å°æ¯å€‹ URL èª¿ç”¨ /api/analyze ç²å–å…§å®¹ç‰¹å¾µ                       â”‚  â”‚
â”‚  â”‚  - çµæœä¿å­˜åˆ° Google Sheet (training_data)                         â”‚  â”‚
â”‚  â”‚  - æ‰¹æ¬¡çµæœä¸Šå‚³è‡³ R2 (serp-results/)                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â†“                                       â”‚
â”‚  â”Œâ”€ é€±äºŒ 03:00 UTC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ éšæ®µ 3ï¼šæ¨¡å‹è¨“ç·´èˆ‡éƒ¨ç½²                                               â”‚  â”‚
â”‚  â”‚  - å¾ Google Sheet è®€å–æ‰€æœ‰è¨“ç·´æ•¸æ“š                                â”‚  â”‚
â”‚  â”‚  - ç‰¹å¾µå·¥ç¨‹ï¼šæå– 50+ å€‹å…§å®¹ç‰¹å¾µ                                    â”‚  â”‚
â”‚  â”‚  - XGBoost æ¨¡å‹è¨“ç·´                                                â”‚  â”‚
â”‚  â”‚  - æ¨¡å‹è©•ä¼°ï¼ˆæº–ç¢ºç‡ã€F1 åˆ†æ•¸ç­‰ï¼‰                                    â”‚  â”‚
â”‚  â”‚  - è½‰æ›ç‚º JavaScript æ ¼å¼                                          â”‚  â”‚
â”‚  â”‚  - éƒ¨ç½²åˆ° scoring-model.js                                         â”‚  â”‚
â”‚  â”‚  - æ›´æ–° KV ä¸­çš„æ¨¡å‹ç‰ˆæœ¬                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â†“                                       â”‚
â”‚  â”Œâ”€ é€±äºŒ 03:30 UTC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ éšæ®µ 4ï¼šæˆæœ¬æ‘˜è¦èˆ‡å ±å‘Š                                               â”‚  â”‚
â”‚  â”‚  - è¨ˆç®—æœ¬é€± API æˆæœ¬                                                â”‚  â”‚
â”‚  â”‚  - ç”Ÿæˆæ€§èƒ½æŒ‡æ¨™                                                     â”‚  â”‚
â”‚  â”‚  - ç™¼é€ Slack é€šçŸ¥                                                 â”‚  â”‚
â”‚  â”‚  - å­˜æª”å ±å‘Šè‡³ R2                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•¸æ“šæµè©³è§£

### 1ï¸âƒ£ ç”¨æˆ¶åˆ†ææ•¸æ“šæ”¶é›†

#### å‰ç«¯æ”¶é›†é»
```
src/pages/AnalysisPage.jsx
  â†“
  ç”¨æˆ¶è¼¸å…¥ï¼š
  - content (å…§å®¹)
  - targetKeywords (ç›®æ¨™é—œéµå­—)
  - contentFormatHint (æ ¼å¼æç¤º)
  â†“
  èª¿ç”¨ /api/analyze
  â†“
  è¿”å›çµæœï¼š
  {
    seo: { 17 å€‹ SEO æŒ‡æ¨™ },
    aeo: { 17 å€‹ AEO æŒ‡æ¨™ },
    recommendations: [ ... ]
  }
```

#### æ•¸æ“šè¨˜éŒ„æµç¨‹
```
functions/api/[[path]].js
  â†“
  logKeywordAnalytics() å‡½æ•¸
  â†“
  è¨˜éŒ„åˆ° KEYWORD_ANALYTICS KVï¼š
  {
    kw:{keyword}:{timestamp}: {
      keyword: string,
      locale: string,
      sessionId: string,
      hasEmail: boolean,
      mode: 'sync' | 'async',
      contentLength: number,
      timestamp: ISO8601
    }
  }
```

#### åŒæ­¥åˆ° Google Sheet
```
ml/serp_collection.py
  â†“
  persist_progress() å‡½æ•¸
  â†“
  sheets_writer.append_record()
  â†“
  Google Sheet (training_data)ï¼š
  [url, keyword, serp_rank, target_score, title, feature1, feature2, ...]
```

---

### 2ï¸âƒ£ é—œéµå­—åŒ¯å‡ºï¼ˆé€±ä¸€ 02:00ï¼‰

#### è§¸ç™¼æ–¹å¼
```
Cloudflare Cron: 0 2 * * 1 (é€±ä¸€ 02:00 UTC)
  â†“
  functions/api/cron-handler.js
  â†“
  handleKeywordExportCron()
```

#### åŸ·è¡Œæµç¨‹
```
Pipeline Scheduler (Durable Object)
  â†“
  executeKeywordExport()
  â†“
  1. å¾ KEYWORD_ANALYTICS KV è®€å–æ‰€æœ‰é—œéµå­—
  2. å»é‡ä¸¦æ’åº
  3. è½‰æ›ç‚º JSON æ ¼å¼
  4. ä¸Šå‚³è‡³ R2: keyword-exports/{date}/keywords.json
  â†“
  è¿”å›çµæœï¼š
  {
    count: number,
    filename: string,
    r2Key: string,
    exportedAt: ISO8601
  }
```

#### é—œéµå­—ä¾†æº
```
KEYWORD_ANALYTICS KV ä¸­çš„æ‰€æœ‰ kw:* éµ
  â†“
  æå– keyword å­—æ®µ
  â†“
  å»é‡ + æ’åº
  â†“
  é è¨­ä¸Šé™ï¼š200 å€‹é—œéµå­—ï¼ˆå¯é…ç½®ï¼‰
```

---

### 3ï¸âƒ£ SERP è’é›†ï¼ˆé€±ä¸€ 02:30ï¼‰

#### è§¸ç™¼æ–¹å¼
```
Cloudflare Cron: 30 2 * * 1 (é€±ä¸€ 02:30 UTC)
  â†“
  functions/api/cron-handler.js
  â†“
  handleSerpCollectionCron()
```

#### åŸ·è¡Œæµç¨‹
```
SERP Collection Scheduler (Durable Object)
  â†“
  startCollection()
  â†“
  1. è®€å– R2 ä¸­çš„é—œéµå­—åˆ—è¡¨
  2. æ‰¹æ¬¡åˆ†å‰²ï¼ˆé è¨­ 10 å€‹/æ‰¹ï¼‰
  3. å°æ¯å€‹æ‰¹æ¬¡åŸ·è¡Œï¼š
     a. èª¿ç”¨ SerpAPI/ValueSERP/ZenSERP
     b. ç²å–æ’åçµæœï¼ˆå‰ 10 å€‹ URLï¼‰
     c. å°æ¯å€‹ URL èª¿ç”¨ /api/analyze
     d. è¨˜éŒ„çµæœåˆ° Google Sheet
     e. ä¸Šå‚³æ‰¹æ¬¡çµæœè‡³ R2
```

#### æ•¸æ“šçµæ§‹
```
Google Sheet (training_data) æ–°å¢è¡Œï¼š
{
  url: string,
  keyword: string,
  serp_rank: number (1-10),
  target_score: number (0-100),
  title: string,
  feature_1: number,
  feature_2: number,
  ...
  feature_50+: number
}

R2 å­˜å„² (serp-results/{date}/batch-{index}.json)ï¼š
{
  batchIndex: number,
  recordCount: number,
  records: [
    {
      keyword: string,
      url: string,
      title: string,
      rank: number,
      timestamp: ISO8601,
      analysis: { ... }
    }
  ],
  uploadedAt: ISO8601
}
```

#### ç‰¹å¾µæå–
```
/api/analyze è¿”å›çš„ç‰¹å¾µï¼š
- contentSignals: {
    wordCount,
    paragraphCount,
    hcuYesRatio,
    hcuPartialRatio,
    hcuNoRatio,
    titleIntentMatch,
    firstParagraphAnswerQuality,
    qaFormatScore,
    topicCohesion,
    semanticParagraphFocus,
    ... (50+ å€‹ç‰¹å¾µ)
  }
```

---

### 4ï¸âƒ£ æ¨¡å‹è¨“ç·´èˆ‡éƒ¨ç½²ï¼ˆé€±äºŒ 03:00ï¼‰

#### è§¸ç™¼æ–¹å¼
```
Cloudflare Cron: 0 3 * * 2 (é€±äºŒ 03:00 UTC)
  â†“
  functions/api/cron-handler.js
  â†“
  handleModelTrainingCron()
```

#### åŸ·è¡Œæµç¨‹
```
Model Deployment Scheduler (Durable Object)
  â†“
  executeModelTraining()
  â†“
  ml/train_model_cli.py
  â†“
  1. å¾ Google Sheet è®€å–æ‰€æœ‰è¨“ç·´æ•¸æ“š
  2. æ•¸æ“šæ¸…ç† + ç‰¹å¾µå·¥ç¨‹
  3. è¨“ç·´/æ¸¬è©¦é›†åˆ†å‰² (80/20)
  4. XGBoost æ¨¡å‹è¨“ç·´
  5. æ¨¡å‹è©•ä¼°
  6. è½‰æ›ç‚º JavaScript æ ¼å¼
  7. æ›´æ–° functions/api/scoring-model.js
  8. éƒ¨ç½²åˆ° KV
```

#### æ¨¡å‹é…ç½®
```
XGBoost åƒæ•¸ï¼š
- n_estimators: 100
- max_depth: 6
- learning_rate: 0.1
- subsample: 0.8
- colsample_bytree: 0.8

è©•ä¼°æŒ‡æ¨™ï¼š
- æº–ç¢ºç‡ (Accuracy)
- F1 åˆ†æ•¸
- ROC-AUC
- ç‰¹å¾µé‡è¦æ€§æ’å
```

#### æ¨¡å‹ç‰ˆæœ¬ç®¡ç†
```
KV å­˜å„² (model:config)ï¼š
{
  version: "2025-11-15-v2",
  trainedAt: ISO8601,
  trainingDataCount: number,
  accuracy: number,
  f1Score: number,
  features: [
    { name: string, importance: number },
    ...
  ],
  metrics: { ... }
}

scoring-model.js æ›´æ–°ï¼š
- æ–°å¢ DEFAULT_MODEL ç‰ˆæœ¬
- æ›´æ–°æ‰€æœ‰ç‰¹å¾µè¨ˆç®—é‚è¼¯
- æ›´æ–°æ¬Šé‡é…ç½®
```

---

### 5ï¸âƒ£ æˆæœ¬æ‘˜è¦èˆ‡å ±å‘Šï¼ˆé€±äºŒ 03:30ï¼‰

#### è§¸ç™¼æ–¹å¼
```
Cloudflare Cron: 30 3 * * 2 (é€±äºŒ 03:30 UTC)
  â†“
  functions/api/cron-handler.js
  â†“
  handleCostSummaryAndReporting()
```

#### åŸ·è¡Œæµç¨‹
```
Reporting Scheduler (Durable Object)
  â†“
  1. è¨ˆç®—æœ¬é€±æˆæœ¬
  2. ç”Ÿæˆæ€§èƒ½æŒ‡æ¨™
  3. ç™¼é€ Slack é€šçŸ¥
  4. å­˜æª”å ±å‘Šè‡³ R2
```

#### æˆæœ¬è¨ˆç®—
```
ml/cost_tracker.py
  â†“
  è¨ˆç®—é …ç›®ï¼š
  - SerpAPI æˆæœ¬
  - ValueSERP æˆæœ¬
  - ZenSERP æˆæœ¬
  - Gemini API æˆæœ¬
  - Cloudflare Worker æˆæœ¬
  - R2 å­˜å„²æˆæœ¬
  â†“
  è¼¸å‡ºæ ¼å¼ï¼š
  {
    date: ISO8601,
    services: {
      serpapi: { calls: number, cost: number },
      valueserp: { calls: number, cost: number },
      zenserp: { calls: number, cost: number },
      gemini: { calls: number, cost: number },
      cloudflare: { calls: number, cost: number },
      r2: { storage: number, cost: number }
    },
    totalCost: number,
    recordsCollected: number,
    avgCostPerRecord: number
  }
```

#### å ±å‘Šå…§å®¹
```
Slack é€šçŸ¥ï¼š
âœ… æœ¬é€± SERP è’é›†å®Œæˆ
- æ”¶é›†é—œéµå­—æ•¸ï¼š200
- æ”¶é›† URL æ•¸ï¼š2000
- æˆåŠŸç‡ï¼š98%
- ç¸½æˆæœ¬ï¼š$12.50
- å¹³å‡æˆæœ¬/è¨˜éŒ„ï¼š$0.006

ğŸ“Š æ¨¡å‹è¨“ç·´å®Œæˆ
- è¨“ç·´æ•¸æ“šï¼š2000 ç­†
- æº–ç¢ºç‡ï¼š92.5%
- F1 åˆ†æ•¸ï¼š0.91
- æ–°æ¨¡å‹ç‰ˆæœ¬ï¼š2025-11-15-v2

R2 å­˜æª”ï¼š
- reports/{date}/weekly-report.json
- reports/{date}/cost-summary.json
```

---

## ğŸ”§ ç³»çµ±çµ„ä»¶

### æ ¸å¿ƒ Durable Objects

#### 1. PipelineScheduler
```
ä½ç½®: functions/api/pipeline-scheduler.js
è·è²¬:
- ç®¡ç†æ•´å€‹ Pipeline çš„ç‹€æ…‹æ©Ÿ
- å”èª¿å„å€‹éšæ®µçš„åŸ·è¡Œ
- å¤±æ•—é‡è©¦æ©Ÿåˆ¶
- å¥åº·æª¢æŸ¥

API ç«¯é»:
- GET /pipeline/status - å–å¾—ç‹€æ…‹
- GET /pipeline/health - å¥åº·æª¢æŸ¥
- POST /pipeline/start - å•Ÿå‹•
- POST /pipeline/cancel - å–æ¶ˆ
- POST /pipeline/retry/:phase - é‡è©¦éšæ®µ
```

#### 2. SerpCollectionScheduler
```
ä½ç½®: functions/api/serp-collection-scheduler.js
è·è²¬:
- ç®¡ç† SERP è’é›†ä»»å‹™
- æ‰¹æ¬¡è™•ç†
- é€²åº¦è¿½è¹¤
- R2 ä¸Šå‚³

API ç«¯é»:
- GET /serp-collection/status - å–å¾—ç‹€æ…‹
- POST /serp-collection/start - å•Ÿå‹•è’é›†
- POST /serp-collection/cancel - å–æ¶ˆè’é›†
```

#### 3. ModelDeploymentScheduler
```
ä½ç½®: functions/api/model-deployment-scheduler.js
è·è²¬:
- ç®¡ç†æ¨¡å‹è¨“ç·´ä»»å‹™
- æ¨¡å‹ç‰ˆæœ¬ç®¡ç†
- KV éƒ¨ç½²

API ç«¯é»:
- GET /model-deployment/status - å–å¾—ç‹€æ…‹
- POST /model-deployment/start - å•Ÿå‹•è¨“ç·´
```

#### 4. ReportingScheduler
```
ä½ç½®: functions/api/reporting-scheduler.js
è·è²¬:
- ç”Ÿæˆæˆæœ¬å ±å‘Š
- Slack é€šçŸ¥
- å ±å‘Šå­˜æª”

API ç«¯é»:
- POST /reporting/daily - æ¯æ—¥å ±å‘Š
- POST /reporting/weekly - é€±å ±
```

### å­˜å„²ç³»çµ±

#### KV Namespace
```
KEYWORD_ANALYTICS:
- kw:{keyword}:{timestamp}: ç”¨æˆ¶åˆ†æè¨˜éŒ„
- model:config: ç•¶å‰æ¨¡å‹é…ç½®
- model:version: æ¨¡å‹ç‰ˆæœ¬è™Ÿ

ANALYSIS_RESULTS:
- analysis:{taskId}: éåŒæ­¥åˆ†æçµæœ
```

#### R2 Bucket
```
keyword-exports/{date}/keywords.json - åŒ¯å‡ºçš„é—œéµå­—
serp-results/{date}/batch-{index}.json - SERP è’é›†çµæœ
reports/{date}/weekly-report.json - é€±å ±
reports/{date}/cost-summary.json - æˆæœ¬æ‘˜è¦
models/{version}/model.json - æ¨¡å‹é…ç½®
```

#### Google Sheet
```
Sheet ID: 1TFi2lUHtlft4XuJBxTlnvi9Svd_9pXDVOLttCDB248Y
Tab 1: training_data
- åˆ—: [url, keyword, serp_rank, target_score, title, feature1, feature2, ...]
- ç”¨é€”: è¨“ç·´æ•¸æ“šå­˜å„²

Tab 2: collection_progress
- åˆ—: [keyword, processed_at]
- ç”¨é€”: è’é›†é€²åº¦è¿½è¹¤
```

---

## ğŸ“ˆ æ•¸æ“šæµé‡ä¼°ç®—

### æ¯é€±æ•¸æ“šé‡
```
ç”¨æˆ¶åˆ†æï¼š
- æ—¥å‡åˆ†ææ¬¡æ•¸ï¼š50-100
- é€±å‡åˆ†ææ¬¡æ•¸ï¼š350-700
- æ¯æ¬¡åˆ†ææ¶‰åŠé—œéµå­—ï¼š1-5 å€‹
- é€±å‡æ–°å¢é—œéµå­—ï¼š100-200 å€‹

SERP è’é›†ï¼š
- é—œéµå­—æ•¸ï¼š200 å€‹
- æ¯å€‹é—œéµå­— URL æ•¸ï¼š10 å€‹
- ç¸½ URL æ•¸ï¼š2000 å€‹
- æ–°å¢è¨“ç·´æ•¸æ“šï¼š2000 ç­†

æ¨¡å‹è¨“ç·´ï¼š
- è¨“ç·´æ•¸æ“šç¸½é‡ï¼š2000+ ç­†
- ç‰¹å¾µæ•¸ï¼š50+
- æ¨¡å‹å¤§å°ï¼š~50KB (JavaScript)
```

### æˆæœ¬ä¼°ç®—ï¼ˆæ¯æœˆï¼‰
```
SerpAPI: $0.50-1.00
ValueSERP: $0.20-0.50
ZenSERP: $0.20-0.50
Gemini API: $10-20
Cloudflare Worker: $0 (å…è²»å±¤)
Durable Objects: $0.15
R2 å­˜å„²: $0.50
KV å­˜å„²: $0.50
Google Sheets: å…è²»
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¸½è¨ˆ: $12-23/æœˆ
```

---

## ğŸš€ éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### å‰ç½®æ¢ä»¶
- [ ] Cloudflare Worker ç’°å¢ƒé…ç½®
- [ ] R2 bucket å·²å»ºç«‹
- [ ] KV namespace å·²ç¶å®š
- [ ] Google Sheet å·²å»ºç«‹
- [ ] SerpAPI/ValueSERP/ZenSERP API Key å·²é…ç½®
- [ ] Gemini API Key å·²é…ç½®
- [ ] Slack Webhook URL å·²é…ç½®ï¼ˆå¯é¸ï¼‰

### éƒ¨ç½²æ­¥é©Ÿ
- [ ] éƒ¨ç½² Worker ä»£ç¢¼
- [ ] é…ç½® Cron è§¸ç™¼
- [ ] æ¸¬è©¦ Pipeline ç‹€æ…‹æ©Ÿ
- [ ] æ¸¬è©¦ SERP è’é›†
- [ ] æ¸¬è©¦æ¨¡å‹è¨“ç·´
- [ ] é©—è­‰ Google Sheet åŒæ­¥
- [ ] é©—è­‰ R2 ä¸Šå‚³
- [ ] é©—è­‰ Slack é€šçŸ¥

### ç›£æ§æŒ‡æ¨™
- [ ] Pipeline åŸ·è¡Œæ™‚é–“
- [ ] SERP è’é›†æˆåŠŸç‡
- [ ] æ¨¡å‹è¨“ç·´æº–ç¢ºç‡
- [ ] API æˆæœ¬
- [ ] å­˜å„²ä½¿ç”¨é‡
- [ ] éŒ¯èª¤ç‡

---

## ğŸ“ é…ç½®ç¤ºä¾‹

### wrangler.toml
```toml
[[env.production.crons]]
crons = ["0 2 * * 1"]  # é€±ä¸€ 02:00
handler = "cron-handler"

[[env.production.crons]]
crons = ["30 2 * * 1"]  # é€±ä¸€ 02:30
handler = "cron-handler"

[[env.production.crons]]
crons = ["0 3 * * 2"]  # é€±äºŒ 03:00
handler = "cron-handler"

[[env.production.crons]]
crons = ["30 3 * * 2"]  # é€±äºŒ 03:30
handler = "cron-handler"

[[durable_objects.bindings]]
name = "PIPELINE_SCHEDULER"
class_name = "PipelineScheduler"

[[durable_objects.bindings]]
name = "SERP_COLLECTION_SCHEDULER"
class_name = "SerpCollectionScheduler"

[[durable_objects.bindings]]
name = "MODEL_DEPLOYMENT_SCHEDULER"
class_name = "ModelDeploymentScheduler"

[[durable_objects.bindings]]
name = "REPORTING_SCHEDULER"
class_name = "ReportingScheduler"
```

### .env é…ç½®
```bash
# Google Sheets
SHEETS_TRAINING_DATA_ID=1TFi2lUHtlft4XuJBxTlnvi9Svd_9pXDVOLttCDB248Y
SHEETS_TRAINING_DATA_TAB=training_data
SHEETS_PROGRESS_TAB=collection_progress
GOOGLE_APPLICATION_CREDENTIALS=./credentials.json

# SERP APIs
SERPAPI_KEY=your_key
VALUESERP_KEY=your_key
ZENSERP_KEY=your_key

# Gemini
GEMINI_API_KEY=your_key

# Slack
SLACK_WEBHOOK_URL=https://hooks.slack.com/...

# Model Training
MODEL_TRAINING_API_URL=http://localhost:8000/train
```

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. SERP è’é›†å¤±æ•—
```
ç—‡ç‹€: SERP è’é›†éšæ®µè¶…æ™‚æˆ–è¿”å›éŒ¯èª¤
åŸå› : 
- API é…é¡è¶…é™
- ç¶²è·¯é€£æ¥å•é¡Œ
- åˆ†æ API æ•…éšœ

è§£æ±º:
1. æª¢æŸ¥ API é…é¡
2. æŸ¥çœ‹ Worker æ—¥èªŒ
3. é‡è©¦å¤±æ•—çš„éšæ®µ
```

#### 2. æ¨¡å‹è¨“ç·´å¤±æ•—
```
ç—‡ç‹€: æ¨¡å‹è¨“ç·´ç„¡æ³•å®Œæˆ
åŸå› :
- è¨“ç·´æ•¸æ“šä¸è¶³
- ç‰¹å¾µç¼ºå¤±
- è¨˜æ†¶é«”ä¸è¶³

è§£æ±º:
1. æª¢æŸ¥ Google Sheet æ•¸æ“š
2. é©—è­‰ç‰¹å¾µæå–
3. å¢åŠ è¨“ç·´æ•¸æ“š
```

#### 3. Google Sheet åŒæ­¥å¤±æ•—
```
ç—‡ç‹€: æ•¸æ“šæœªåŒæ­¥åˆ° Google Sheet
åŸå› :
- èªè­‰å¤±æ•—
- é…é¡é™åˆ¶
- Sheet æ ¼å¼éŒ¯èª¤

è§£æ±º:
1. é©—è­‰ credentials.json
2. æª¢æŸ¥ Sheet ID
3. æŸ¥çœ‹ Sheets API é…é¡
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- `PIPELINE_AUTOMATION.md` - Pipeline æ•´é«”æ¶æ§‹
- `SERP_COLLECTION_BATCH.md` - SERP è’é›†è©³ç´°æŒ‡å—
- `MODEL_TRAINING_DEPLOYMENT.md` - æ¨¡å‹è¨“ç·´è©³ç´°æŒ‡å—
- `MONITORING_COST_TRACKING.md` - ç›£æ§èˆ‡æˆæœ¬è¿½è¹¤
- `PIPELINE_INTEGRATION_QA.md` - é›†æˆèˆ‡ QA

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **é©—è­‰ç³»çµ±é‹è¡Œ**
   - æ¸¬è©¦å„å€‹ Pipeline éšæ®µ
   - é©—è­‰æ•¸æ“šæµ
   - ç›£æ§æˆæœ¬

2. **å„ªåŒ–æ¨¡å‹**
   - æ”¶é›†æ›´å¤šè¨“ç·´æ•¸æ“š
   - èª¿æ•´ç‰¹å¾µå·¥ç¨‹
   - å„ªåŒ–è¶…åƒæ•¸

3. **æ“´å±•åŠŸèƒ½**
   - æ”¯æ´æ›´å¤šèªè¨€
   - å¤šæ¨¡å‹é›†æˆ
   - A/B æ¸¬è©¦

4. **ç›£æ§èˆ‡å‘Šè­¦**
   - è¨­ç½®æ€§èƒ½å‘Šè­¦
   - æˆæœ¬ç›£æ§
   - éŒ¯èª¤å‘Šè­¦
